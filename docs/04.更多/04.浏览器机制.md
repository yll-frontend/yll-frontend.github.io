---
title: 浏览器机制
date: 2021-07-13 21:08:24
permalink: /pages/b6e2b8/
categories:
  - 更多
tags:
  - 浏览器
---
# 渲染引擎渲染

+ 构建dom树
+ 构建css树
+ 构建渲染树
+ 节点渲染
+ 页面布局

## js引擎执行

+ 词法分析
+ 语法分析（生成语法树）
+ 代码生成
:::tip
浏览器工作大体流程渲染引擎首先通过网络获得所请求文档的内容，通常以8K分块的方式完成。
:::

## 渲染引擎

下面是渲染引擎在取得内容之后的**基本流程**：

+ 解析html为dom树，解析css为cssom。渲染引擎开始解析html，并将标签转化为内容树中的dom节点。
+ 把dom和cssom结合起来生成渲染树(render)。接着，它解析外部CSS文件及style标签中的样式信息。这些样式信息以及html中的可见性指令将被用来构建另一棵树——render树。Render树由一些包含有颜色和大小等属性的矩形组成，它们将被按照正确的顺序显示到屏幕上。
+ 布局渲染树，计算几何形状。Render树构建好了之后，将会执行布局过程，它将确定每个节点在屏幕上的确切坐标。
+ 把渲染树展示到屏幕上。再下一步就是绘制，即遍历render树，并使用UI后端层绘制每个节点。

## 回流与重绘

### 重绘

  当元素属性发生改变且不影响布局时（背景颜色、透明度、字体样式等），产生重绘，相当于 不刷新页面，动态更新内容。

### 回流

  当元素属性发生改变且影响布局时（宽度、高度、内外边距等），产生回流，相当于 刷新页面。
  :::tip
  重绘不一定引起回流，回流必将引起重绘
  :::

### 如何减少回流和重绘？

+ 使用 `transform` 替代 `top`
+ 使用 `visibility` 替换 `display: none` ，因为前者只会引起重绘，后者会引发回流（改变了布局）
+ 不要使用 table 布局，可能很小的一个小改动会造成整个 table 的重新布局
+ 动画实现的速度的选择，动画速度越快，回流次数越多，也可以选择使用`requestAnimationFrame`
+ CSS 选择符从右往左匹配查找，避免节点层级过多
+ 将频繁重绘或者回流的节点设置为图层，图层能够阻止该节点的渲染行为影响别的节点。比如对于 video 标签来说，浏览器会自动将该节点变为图层。
