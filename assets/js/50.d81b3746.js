(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{374:function(e,t,s){"use strict";s.r(t);var o=s(4),i=Object(o.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"cookie、session、token、jwt、单点登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie、session、token、jwt、单点登录"}},[e._v("#")]),e._v(" cookie、session、token、jwt、单点登录")]),e._v(" "),t("p",[e._v("http协议是无状态协议，前段如何保存一些状态呐？利用存储！（localstorage,cookies）")]),e._v(" "),t("h2",{attrs:{id:"最初-cookie"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最初-cookie"}},[e._v("#")]),e._v(" 最初:cookie")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("前端发送请求，> [https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/37adb2019d064967923a659848870771~tplv-k3u1fbpfcp-watermark.image]\n验证Uesr库，验证通过后，向Seesion存储uesrname和password，生成seesionId，返回数据set-cookies：seesionid，前端再次发送请求时，会携带seesionid，\nseesion库验证通过后正常处理请求。")])]),e._v(" "),t("li",[t("p",[e._v("Session 的分布式问题")]),e._v(" "),t("p",[e._v("通常服务端是集群，而用户请求过来会走一次负载均衡，不一定打到哪台机器上。那一旦用户后续接口请求到的机器和他登录请求的机器不一致，或者登录请求的机器宕机了，session 不就失效了吗？")])]),e._v(" "),t("li",[t("p",[e._v("这个问题现在有几种解决方式:")]),e._v(" "),t("p",[e._v("一是从「存储」角度，把 session 集中存储。如果我们用独立的 Redis 或普通数据库，就可以把 session 都存到一个库里。\n二是从「分布」角度，让相同 IP 的请求在负载均衡时都打到同一台机器上。以 nginx 为例，可以配置 ip_hash 来实现。")])])]),e._v(" "),t("h2",{attrs:{id:"进阶-token"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进阶-token"}},[e._v("#")]),e._v(" 进阶:Token")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("token 的流程是这样的：> [https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1c57a08eb204f528256f3980c721148~tplv-k3u1fbpfcp-watermark.image]")]),e._v(" "),t("ul",[t("li",[e._v("用户登录，服务端校验账号密码，获得用户信息")]),e._v(" "),t("li",[e._v("把用户信息、token 配置编码成 token，通过 cookie set 到浏览器")]),e._v(" "),t("li",[e._v("此后用户请求业务接口，通过 cookie 携带 token")]),e._v(" "),t("li",[e._v("接口校验 token 有效性，进行正常业务接口处理")])])]),e._v(" "),t("li",[t("p",[e._v("缺点：\n访问一些敏感信息时，我们必须需要设置token的有效期很短，这样用户才会比较安全，\n但是token有效期短暂的画，用户就必须频繁的重新请求token，这样不利于用户体验，我们就必须想办法自动刷新token")])])]),e._v(" "),t("h2",{attrs:{id:"升级-refreshtoken"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级-refreshtoken"}},[e._v("#")]),e._v(" 升级:RefreshToken")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("access token 用来访问业务接口，由于有效期足够短，盗用风险小，也可以使请求方式更宽松灵活")])]),e._v(" "),t("li",[t("p",[e._v("refresh token 用来获取 access token，有效期可以长一些，通过独立服务和严格的请求方式增加安全性；由于不常验证，也可以如前面的 session 一样处理")])]),e._v(" "),t("li",[t("p",[e._v("流程:")]),e._v(" "),t("blockquote",[t("p",[e._v("[https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b764b256211b4ea182388fd92674fe70~tplv-k3u1fbpfcp-watermark.image?imageslim]")])])])]),e._v(" "),t("h2",{attrs:{id:"终极-单点登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#终极-单点登录"}},[e._v("#")]),e._v(" 终极:单点登录")]),e._v(" "),t("blockquote",[t("p",[e._v("[https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf2e8ba61fc94b52be164c207b9d8358~tplv-k3u1fbpfcp-watermark.image]")])])])}),[],!1,null,null,null);t.default=i.exports}}]);